<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KBC - Host Control Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io("https://kbc-for-raisoni-2.onrender.com");
  </script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Montserrat', sans-serif; 
      background: #0a0a2a; 
      color: #eee; 
      padding: 0;
      overflow-x: hidden;
    }
    header {
      text-align: center;
      padding: 20px;
      background: #0a0a2a;
      border-bottom: 4px solid gold;
      color: white;
    }
    .prize-ladder {
      background: #0d1a33;
      padding: 15px;
      margin: 15px auto;
      max-width: 900px;
      text-align: center;
      border-radius: 8px;
      border: 1px solid #2a3c5b;
    }
    .prize-ladder span {
      display: inline-block;
      margin: 3px;
      padding: 6px 12px;
      background: #1a2c4d;
      color: gold;
      font-size: 0.9rem;
      border: 1px solid gold;
      border-radius: 4px;
    }
    .host-panel {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    .lifeline-bar {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .lifeline-btn {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: 0.2s;
    }
    .lifeline-btn:hover { transform: translateY(-2px); }
    #lf-5050 { background: #e74c3c; color: white; }
    #lf-friend { background: #3498db; color: white; }
    #lf-audience { background: #2ecc71; color: white; }
    .flip-btn { background: #0099cc; color: white; }
    .search-box input {
      width: 100%;
      max-width: 500px;
      padding: 12px;
      border-radius: 8px;
      border: none;
      background: #0f1a2e;
      color: white;
      font-size: 1rem;
      margin: 15px auto;
      display: block;
    }
    .table-container {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      margin: 20px 0;
      max-height: 50vh;
      overflow-y: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #0f1a2e;
      color: #eee;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #2a3c5b;
    }
    th {
      background: #001f5b;
      color: gold;
      position: sticky;
      top: 0;
      font-weight: 600;
    }
    td {
      color: #ccc;
    }
    .hint-col {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .hint-col span {
      flex: 1;
      cursor: pointer;
      color: #aaa;
    }
    .hint-col i {
      color: #0099cc;
      font-size: 1.2rem;
      cursor: pointer;
    }
    .action-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      font-size: 0.85rem;
      background: #0099cc;
      color: white;
      cursor: pointer;
    }
    .action-btn[disabled] {
      background: #555;
      cursor: not-allowed;
    }
    .requests-area {
      background: #0d1a33;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      border: 1px solid #2a3c5b;
      max-height: 120px;
      overflow-y: auto;
    }
    .requests-list li {
      padding: 8px;
      margin: 5px 0;
      background: #1a2c4d;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    #hint-modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #0a0a2a;
      color: white;
      padding: 30px;
      border-radius: 12px;
      max-width: 80%;
      max-height: 80vh;
      overflow-y: auto;
      border: 2px solid gold;
      text-align: left;
    }
    .modal-title {
      color: gold;
      font-size: 1.4rem;
      margin-bottom: 15px;
    }
    .close-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background: #0099cc;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <h1>üì∫ KBC Host Control Panel</h1>
    <a href="index.html" style="color: gold; text-decoration: underline;">‚Üê Back to Player View</a>
  </header>

  <!-- Prize Money Ladder -->
  <div class="prize-ladder">
    <span>‚Çπ 3,000</span>
    <span>‚Çπ 2,500</span>
    <span>‚Çπ 2,000</span>
    <span>‚Çπ 1,500</span>
    <span>‚Çπ 1,000</span>
    <span>‚Çπ 900</span>
    <span>‚Çπ 800</span>
    <span>‚Çπ 700</span>
    <span>‚Çπ 600</span>
    <span>‚Çπ 500</span>
    <span>‚Çπ 400</span>
    <span>‚Çπ 300</span>
    <span>‚Çπ 200</span>
    <span>‚Çπ 100</span>
    <span>‚Çπ 0</span>
  </div>

  <div class="host-panel">

    <!-- Lifeline Buttons -->
    <div class="lifeline-bar">
      <button id="lf-5050" onclick="triggerFiftyFifty()">üéØ 50:50</button>
      <button id="lf-friend" onclick="forceLifeline('Ask Friend')">üìû Ask Friend</button>
      <button id="lf-audience" onclick="forceLifeline('Ask Audience')">üë• Ask Audience</button>
      <button class="flip-btn" onclick="flipQuestion()">üîÑ Flip Question</button>
    </div>

    <!-- Search Box -->
    <input type="text" placeholder="üîç Search questions..." id="search-input" onkeyup="searchQuestions()">

    <!-- Questions Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Question</th>
            <th>Options</th>
            <th>Answer</th>
            <th>Hint</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>

    <!-- Lifeline Requests -->
    <div class="requests-area">
      <h3>üõéÔ∏è Lifeline Requests</h3>
      <ul class="requests-list" id="requests-list">
        <li>No requests yet</li>
      </ul>
    </div>

  </div>

  <!-- Hint Modal -->
  <div id="hint-modal">
    <div class="modal-content">
      <h3 class="modal-title"></h3>
      <div id="modal-text"></div>
      <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
  </div>

  <script>
    window.isHost = true;
    let sentQuestions = new Set();
    let currentQuestionData = null;
    const usedLifelines = new Set();

    // üî• 9 NEW QUESTIONS ‚Äî GROUPED AS ROUND 1 (1-2-3), ROUND 2 (11-12-13), ROUND 3 (21-22-23)
    const questions = [
      // ROUND 1: EASY (Q1-Q3)
      {
        id: 1,
        text: "What is the binary equivalent of decimal number 10?",
        options: { A: "1110", B: "1100", C: "1010", D: "1001" },
        correct: "C",
        description: "The binary equivalent of decimal 10 is 1010. (8 + 2 = 10)"
      },
      {
        id: 2,
        text: "Which type of memory is non-volatile and retains data even when power is off?",
        options: { A: "RAM", B: "Cache", C: "ROM", D: "Register" },
        correct: "C",
        description: "ROM (Read-Only Memory) is permanent storage and does not lose data when power is switched off."
      },
      {
        id: 3,
        text: "Which is not an example of an operating system?",
        options: { A: "Windows", B: "Linux", C: "MS Word", D: "MacOS" },
        correct: "C",
        description: "MS Word is an application software, not an OS. An OS manages hardware and software resources."
      },

      // ROUND 2: MEDIUM (Q11-Q13)
      {
        id: 11,
        text: "Which of these is an example of Artificial Intelligence in daily life?",
        options: { A: "Online Calculator", B: "Google Maps Navigation", C: "Notepad", D: "MS Paint" },
        correct: "B",
        description: "Google Maps uses AI to predict traffic, find shortest routes, and provide real-time directions."
      },
      {
        id: 12,
        text: "Which of the following is a secondary storage device?",
        options: { A: "RAM", B: "Hard Disk", C: "Cache Memory", D: "Register" },
        correct: "B",
        description: "Hard disks are non-volatile and used for long-term data storage. RAM and cache are primary memory."
      },
      {
        id: 13,
        text: "The speed of an internet connection is usually measured in:",
        options: { A: "MB", B: "Mbps", C: "Hz", D: "GB" },
        correct: "B",
        description: "Internet speed is measured in megabits per second (Mbps), while MB and GB refer to data size, not speed."
      },

      // ROUND 3: HARD (Q21-Q23)
      {
        id: 21,
        text: "Which generation of computers used Integrated Circuits (ICs)?",
        options: { A: "First Generation", B: "Second Generation", C: "Third Generation", D: "Fourth Generation" },
        correct: "C",
        description: "Third-generation computers (1965‚Äì1971) used ICs, making them smaller, faster, and more reliable."
      },
      {
        id: 22,
        text: "Which technology is used in chat bots like Chat GPT?",
        options: { A: "Machine Learning", B: "Data Mining", C: "Cloud Storage", D: "Cryptography" },
        correct: "A",
        description: "Chatbots use machine learning and natural language processing (NLP) to understand and respond to human language."
      },
      {
        id: 23,
        text: "Which component of a computer executes instructions from programs?",
        options: { A: "Hard Disk", B: "RAM", C: "CPU", D: "GPU" },
        correct: "C",
        description: "The CPU (Central Processing Unit) is the brain of the computer that executes program instructions."
      }
    ];

    function renderTable(qs = questions) {
      const tbody = document.getElementById('table-body');
      tbody.innerHTML = '';
      qs.forEach(q => {
        const opts = `${q.options.A} | ${q.options.B} | ${q.options.C} | ${q.options.D}`;
        const descShort = q.description.length > 60 ? q.description.substring(0, 60) + '...' : q.description;

        const row = document.createElement('tr');
        row.innerHTML = `
          <td style="color:white; padding:10px; text-align:center; font-weight:bold;">${q.id}</td>
          <td style="padding:10px; color:#ccc; word-wrap: break-word;">${q.text}</td>
          <td style="padding:10px; color:#aaa; font-size:0.9rem;">${opts}</td>
          <td style="padding:10px; color:gold; text-align:center; font-weight:bold;">${q.correct}</td>
          <td class="hint-col">
            <span>${descShort}</span>
            <i class="fas fa-info-circle" onclick="showFullHint('${q.description}', 'Q${q.id}')"></i>
          </td>
          <td style="text-align:center;">
            <button class="action-btn" onclick="sendQuestion(${q.id - 1})" ${sentQuestions.has(q.id) ? 'disabled' : ''}>
              ${sentQuestions.has(q.id) ? '‚úÖ Sent' : 'üì§ Send'}
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function showFullHint(description, title) {
      document.querySelector('.modal-title').textContent = title;
      document.querySelector('#modal-text').innerHTML = description.replace(/\n/g, '<br>');
      document.getElementById('hint-modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('hint-modal').style.display = 'none';
    }

    function sendQuestion(index) {
      const q = questions[index];
      currentQuestionData = q;
      socket.emit('send-question', { ...q, index });
      sentQuestions.add(q.id);
      renderTable();
      const snd = new Audio("https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3");
      snd.play().catch(e => console.log("Sound failed:", e));
      alert(`‚úÖ Sent Q${q.id}: "${q.text.substring(0, 40)}..."`);
    }

    function markLifelineUsed(type) {
      const btn = document.getElementById(type === '50:50' ? 'lf-5050' : type === 'Ask Friend' ? 'lf-friend' : 'lf-audience');
      if (btn && !usedLifelines.has(type)) {
        btn.style.opacity = '0.6';
        btn.style.cursor = 'not-allowed';
        btn.disabled = true;
        usedLifelines.add(type);
      }
    }

    function forceLifeline(type) {
      if (usedLifelines.has(type)) return alert(`‚ùå "${type}" already used!`);
      socket.emit('use-lifeline', { type, time: new Date().toLocaleTimeString() });
      alert(`üì¢ Host triggered: ${type}`);
      markLifelineUsed(type);
    }

    function triggerFiftyFifty() {
      if (!currentQuestionData) return alert("‚ö†Ô∏è No active question!");
      if (usedLifelines.has('50:50')) return alert("‚ùå 50:50 already used!");
      const correct = currentQuestionData.correct;
      const wrong = ['A','B','C','D'].filter(opt => opt !== correct);
      const toRemove = wrong.sort(() => 0.5 - Math.random()).slice(0, 2);
      socket.emit('fifty-fifty', { remove: toRemove });
      alert(`üéØ 50:50: Hid ${toRemove.join(', ')}`);
      markLifelineUsed('50:50');
    }

    function flipQuestion() {
      for (let i = 0; i < questions.length; i++) {
        if (!sentQuestions.has(questions[i].id)) {
          sendQuestion(i);
          return;
        }
      }
      alert("üéâ All questions sent!");
    }

    function searchQuestions() {
      const term = document.getElementById('search-input').value.toLowerCase();
      const filtered = questions.filter(q => 
        q.text.toLowerCase().includes(term) || 
        q.description.toLowerCase().includes(term)
      );
      renderTable(filtered);
    }

    window.onload = () => {
      socket.emit('join-host');
      renderTable();

      socket.on('lifeline-request', (data) => {
        const list = document.getElementById('requests-list');
        if (list.innerHTML === '<li>No requests yet</li>') list.innerHTML = '';
        const li = document.createElement('li');
        li.textContent = `[${data.time}] Player used: ${data.type}`;
        list.appendChild(li);
        list.scrollTop = list.scrollHeight;
        markLifelineUsed(data.type);
      });
    };
  </script>

</body>
</html>
